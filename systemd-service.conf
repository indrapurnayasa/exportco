[Unit]
Description=Hackathon Service API
Documentation=https://github.com/indrapurnayasa/exportco
After=network.target postgresql.service
Wants=postgresql.service

[Service]
Type=exec
User=hackathon
Group=hackathon
WorkingDirectory=/opt/exportco
Environment=PATH=/opt/exportco/venv/bin
Environment=PYTHONPATH=/opt/exportco
Environment=PYTHONUNBUFFERED=1

# Main process
ExecStart=/opt/exportco/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4

# Restart policy
Restart=always
RestartSec=10
StartLimitInterval=60
StartLimitBurst=3

# Resource limits
LimitNOFILE=65536
LimitNPROC=4096

# Security settings
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/opt/exportco /var/log/exportco /var/backups/exportco

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=exportco

# Health check
ExecStartPre=/opt/exportco/venv/bin/python -c "import requests; requests.get('http://localhost:8000/health', timeout=5)"
ExecStartPre=/bin/sleep 2

[Install]
WantedBy=multi-user.target 