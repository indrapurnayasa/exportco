[Unit]
Description=Hackathon Service API
Documentation=https://github.com/your-username/hackathon-service
After=network.target postgresql.service
Wants=postgresql.service

[Service]
Type=exec
User=hackathon
Group=hackathon
WorkingDirectory=/opt/hackathon-service
Environment=PATH=/opt/hackathon-service/venv/bin
Environment=PYTHONPATH=/opt/hackathon-service
Environment=PYTHONUNBUFFERED=1

# Main process
ExecStart=/opt/hackathon-service/venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8000 --workers 4

# Restart policy
Restart=always
RestartSec=10
StartLimitInterval=60
StartLimitBurst=3

# Resource limits
LimitNOFILE=65536
LimitNPROC=4096

# Security settings
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/opt/hackathon-service /var/log/hackathon-service /var/backups/hackathon-service

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=hackathon-service

# Health check
ExecStartPre=/opt/hackathon-service/venv/bin/python -c "import requests; requests.get('http://localhost:8000/health', timeout=5)"
ExecStartPre=/bin/sleep 2

[Install]
WantedBy=multi-user.target 